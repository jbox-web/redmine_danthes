{"name":"Redmine d'Anthès","tagline":"A Redmine plugin which makes sending asynchronous notifications easy ;)","body":"[![GitHub license](https://img.shields.io/github/license/jbox-web/redmine_danthes.svg)](https://github.com/jbox-web/redmine_danthes/blob/devel/LICENSE)\r\n[![GitHub release](https://img.shields.io/github/release/jbox-web/redmine_danthes.svg)](https://github.com/jbox-web/redmine_danthes/releases/latest)\r\n[![Code Climate](https://codeclimate.com/github/jbox-web/redmine_danthes.png)](https://codeclimate.com/github/jbox-web/redmine_danthes)\r\n[![Build Status](https://travis-ci.org/jbox-web/redmine_danthes.svg?branch=devel)](https://travis-ci.org/jbox-web/redmine_danthes)\r\n[![Dependency Status](https://gemnasium.com/jbox-web/redmine_danthes.svg)](https://gemnasium.com/jbox-web/redmine_danthes)\r\n[![Gitter](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/jbox-web/redmine_danthes?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge)\r\n\r\nThis plugin allows straightforward integration of [d'Anthès](https://github.com/dotpromo/danthes) within Redmine to display nice notifications in Growl style.\r\n\r\nIt relies on :\r\n\r\n* [d'Anthès](https://github.com/dotpromo/danthes) which provide easy [Faye backend](http://faye.jcoglan.com/) integration in any Rails application.\r\n* [async_notifications](https://github.com/jbox-web/async_notifications) gem so plugins developpers can access to the DSL provided to register their own channels and events (see the doc in the [Wiki](https://github.com/jbox-web/redmine_danthes/wiki)).\r\n* [Redmine Bootstrap Kit](https://github.com/jbox-web/redmine_bootstrap_kit) which provides [Bootstrap Notify](https://github.com/mouse0270/bootstrap-notify).\r\n\r\n## Why?\r\n\r\nBefore switching to d'Anthès and write this plugin, I used [Redmine Pusher Notifications](https://github.com/jbox-web/redmine_pusher_notifications) which does exactly the same job... with the drawback that it depends on [Pusher](https://pusher.com/) service to work (a really nice messaging solution by the way).\r\n\r\nWith Redmine d'Anthès, this external dependency is removed so you can use async notifications with no limits ! :)\r\n\r\n## Requirements\r\n\r\n* Ruby 2.0.x\r\n* a working [Redmine](http://www.redmine.org/) installation\r\n* a working Redis server\r\n\r\n## Installation\r\n\r\nAssuming that you have Redmine installed :\r\n\r\n```sh\r\n## Before install the plugin, stop Redmine!\r\n\r\n# Switch user\r\nroot# su - redmine\r\n\r\n# First git clone Bootstrap Kit\r\nredmine$ cd REDMINE_ROOT/plugins\r\nredmine$ git clone https://github.com/jbox-web/redmine_bootstrap_kit.git\r\nredmine$ cd redmine_bootstrap_kit/\r\nredmine$ git checkout 0.2.3\r\n\r\n# Then Redmine d'Anthes plugin\r\nredmine$ cd REDMINE_ROOT/plugins\r\nredmine$ git clone https://github.com/jbox-web/redmine_danthes.git\r\nredmine$ cd redmine_danthes/\r\nredmine$ git checkout 1.0.0\r\n\r\n# Copy Danthes config file to Redmine config dir\r\nredmine$ cp config/danthes*.yml ../../config/\r\n\r\n# Copy ```danthes.ru``` Rack script to Redmine root dir\r\nredmine$ cp danthes.ru ../../\r\n\r\n# Install gems\r\nredmine$ cd REDMINE_ROOT/\r\nredmine$ bundle install --without development test\r\n\r\n## After install the plugin, start Redmine!\r\n```\r\n\r\n## Configuration\r\n\r\nYou **must** configure d'Anthès by editing ```<redmine root>/config/danthes.yml``` file.\r\n\r\nYou will have to set a secret to secure your connection with Faye and the Redmine URL (for instance http://redmine.example.net).\r\n\r\nYou **must** also configure your webserver to redirect Faye requests :\r\n\r\n##### Nginx config :\r\n\r\nAdd this in ```server``` section :\r\n\r\n```nginx\r\nlocation /faye {\r\n  access_log   /data/logs/nginx/faye.access.log;\r\n  error_log    /data/logs/nginx/faye.error.log;\r\n\r\n  proxy_pass http://127.0.0.1:9292;\r\n\r\n  proxy_http_version 1.1;\r\n\r\n  proxy_set_header Upgrade $http_upgrade;\r\n  proxy_set_header Connection $connection_upgrade;\r\n\r\n  proxy_set_header X-Real-IP  $remote_addr;\r\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\r\n  proxy_set_header X-Forwarded-Proto https;\r\n  proxy_set_header Host $http_host;\r\n\r\n  gzip off;\r\n  expires off;\r\n\r\n  chunked_transfer_encoding off;\r\n  proxy_buffering           off;\r\n  proxy_cache               off;\r\n  proxy_redirect            off;\r\n  proxy_send_timeout        850000;\r\n  proxy_read_timeout        850000;\r\n  proxy_connect_timeout     850000;\r\n}\r\n```\r\n\r\nAdd this outside of ```server``` section :\r\n\r\n```nginx\r\nmap $http_upgrade $connection_upgrade {\r\n  default upgrade;\r\n  ''      close;\r\n}\r\n```\r\n\r\n#### Start d'Anthès/Faye!\r\n\r\n```sh\r\nroot# su - redmine\r\nredmine$ cd REDMINE_ROOT\r\nredmine$ rackup danthes.ru -s thin -E production\r\n```\r\n\r\nYou're done!\r\n\r\nNow you may need to add your own notifications channels and events, see below!\r\n\r\n\r\n## Usage\r\n\r\nIf you want to integrate Faye async notifications in your plugin you need to register your own channels and events in your ```init.rb``` file : each channel can have many events.\r\nIt may also have an optional ```target``` parameter which can be a string or a Proc.\r\n\r\n```ruby\r\n## This must be OUTSIDE of the Redmine::Plugin.register block\r\n\r\nAsyncNotifications.register_channel :channel_test do\r\n  target Proc.new { User.current.login }\r\n  event  :event1\r\n  event  :event2\r\n  event  :event3\r\nend\r\n\r\nAsyncNotifications.register_channel :broadcast do\r\n  target 'broadcast'\r\n  event  :event1\r\n  event  :event2\r\n  event  :event3\r\nend\r\n```\r\n\r\nThe rest is handled by the plugin ;)\r\n\r\nTo check that it's working go in Redmine and load any page. Then edit with Firebug. At the bottom you should have something like that :\r\n\r\n```html+erb\r\n<div data-url=\"/my/notifications\" id=\"notifications\" style=\"display: none;\">\r\n  <script type=\"text/javascript\">\r\n    if (typeof Danthes != 'undefined') { Danthes.sign({\"server\":\"http://redmine.example.net/faye\",\"timestamp\":1427061870776,\"channel\":\"/channel_test/admin\",\"signature\":\"8416c90289dbdbd35130da4018d376b5469c1793\"}) }\r\n  </script>\r\n</div>\r\n<script>\r\n  $(document).ready(function() { setAsyncNotifications(); });\r\n</script>\r\n```\r\n\r\nYou should also see connections to Faye and check errors if any.\r\n\r\nNote that if your browser or your connection don't support WebSockets it will fallback to long-polling mode automatically.\r\n\r\n## Contribute\r\n\r\nYou can contribute to this plugin in many ways such as :\r\n* Helping with documentation\r\n* Contributing code (features or bugfixes)\r\n* Reporting a bug\r\n* Submitting translations\r\n","google":"UA-36504891-3","note":"Don't delete this file! It's used internally to help with page regeneration."}